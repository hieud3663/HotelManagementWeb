@{
    ViewData["Title"] = "Báo cáo & Thống kê";
}

<!-- Page Header -->
<div class="page-header fade-in-up">
    <h1>
        <i class="fas fa-chart-bar"></i>
        Báo cáo & Thống kê
    </h1>
    <p>Hệ thống báo cáo và phân tích dữ liệu khách sạn</p>
</div>

<!-- Report Categories -->
<div class="row g-4">
    <!-- Revenue Report -->
    <div class="col-lg-4">
        <div class="card-modern fade-in-up">
            <div class="card-body-modern text-center">
                <div class="stats-icon success mx-auto mb-4">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <h3 class="mb-3">Báo cáo Doanh thu</h3>
                <p class="text-muted mb-4">
                    Thống kê doanh thu từ phòng, dịch vụ theo thời gian
                </p>
                <a asp-action="Revenue" class="btn btn-success-modern w-100">
                    <i class="fas fa-chart-line"></i> Xem báo cáo
                </a>
            </div>
        </div>
    </div>

    <!-- Room Occupancy Report -->
    <div class="col-lg-4">
        <div class="card-modern fade-in-up" style="animation-delay: 0.1s">
            <div class="card-body-modern text-center">
                <div class="stats-icon info mx-auto mb-4">
                    <i class="fas fa-bed"></i>
                </div>
                <h3 class="mb-3">Công suất Phòng</h3>
                <p class="text-muted mb-4">
                    Phân tích tỷ lệ sử dụng phòng, hiệu quả kinh doanh
                </p>
                <a asp-action="RoomOccupancy" class="btn btn-info-modern w-100">
                    <i class="fas fa-chart-pie"></i> Xem báo cáo
                </a>
            </div>
        </div>
    </div>

    <!-- Employee Performance Report -->
    <div class="col-lg-4">
        <div class="card-modern fade-in-up" style="animation-delay: 0.2s">
            <div class="card-body-modern text-center">
                <div class="stats-icon warning mx-auto mb-4">
                    <i class="fas fa-user-tie"></i>
                </div>
                <h3 class="mb-3">Hiệu suất Nhân viên</h3>
                <p class="text-muted mb-4">
                    Đánh giá hiệu quả làm việc của từng nhân viên
                </p>
                <a asp-action="EmployeePerformance" class="btn btn-warning-modern w-100">
                    <i class="fas fa-chart-bar"></i> Xem báo cáo
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row g-4 mt-4">
    <div class="col-12">
        <div class="card-modern fade-in-up" style="animation-delay: 0.3s">
            <div class="card-header-modern">
                <i class="fas fa-tachometer-alt me-2"></i>Tổng quan Hôm nay
            </div>
            <div class="card-body-modern">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="stats-icon primary mx-auto mb-3">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <h4 class="mb-2">@ViewBag.TodayReservations</h4>
                            <p class="text-muted mb-0">Đặt phòng hôm nay</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="stats-icon success mx-auto mb-3">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <h4 class="mb-2">@ViewBag.TodayCheckIns</h4>
                            <p class="text-muted mb-0">Check-in hôm nay</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="stats-icon warning mx-auto mb-3">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <h4 class="mb-2">@ViewBag.TodayCheckOuts</h4>
                            <p class="text-muted mb-0">Check-out hôm nay</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="stats-icon info mx-auto mb-3">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h4 class="mb-2">@(ViewBag.TodayRevenue?.ToString("N0") ?? "0") đ</h4>
                            <p class="text-muted mb-0">Doanh thu hôm nay</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="row g-4 mt-4">
    <!-- Revenue Chart -->
    <div class="col-lg-6">
        <div class="card-modern fade-in-up" style="animation-delay: 0.4s">
            <div class="card-header-modern">
                <i class="fas fa-chart-bar me-2"></i>Doanh thu 6 tháng gần đây
            </div>
            <div class="card-body-modern">
                <canvas id="revenueChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Room Occupancy Pie Chart -->
    <div class="col-lg-6">
        <div class="card-modern fade-in-up" style="animation-delay: 0.5s">
            <div class="card-header-modern">
                <i class="fas fa-chart-pie me-2"></i>Phân bố loại phòng (Tháng này)
            </div>
            <div class="card-body-modern">
                <canvas id="roomOccupancyChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Booking Trend Chart -->
    <div class="col-lg-6">
        <div class="card-modern fade-in-up" style="animation-delay: 0.6s">
            <div class="card-header-modern">
                <i class="fas fa-chart-line me-2"></i>Xu hướng đặt phòng (30 ngày)
            </div>
            <div class="card-body-modern">
                <canvas id="bookingTrendChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Employee Performance Chart -->
    <div class="col-lg-6">
        <div class="card-modern fade-in-up" style="animation-delay: 0.7s">
            <div class="card-header-modern">
                <i class="fas fa-user-chart me-2"></i>Top 10 Nhân viên (Check-in tháng này)
            </div>
            <div class="card-body-modern">
                <canvas id="employeePerformanceChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Fetch và render Revenue Chart
    fetch('/Report/GetRevenueChartData?months=6')
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('vi-VN') + ' đ';
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Error loading revenue chart:', err));

    // Fetch và render Room Occupancy Pie Chart
    fetch('/Report/GetRoomOccupancyChartData')
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('roomOccupancyChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed + ' lượt';
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Error loading room occupancy chart:', err));

    // Fetch và render Booking Trend Line Chart
    fetch('/Report/GetBookingTrendChartData?days=30')
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('bookingTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Error loading booking trend chart:', err));

    // Fetch và render Employee Performance Bar Chart
    fetch('/Report/GetEmployeePerformanceChartData?topN=10')
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('employeePerformanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Error loading employee performance chart:', err));
</script>
}

